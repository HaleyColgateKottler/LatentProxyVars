---
title: "matching"
format: html
editor: visual
---

```{r}
tag = "1"
```

```{r}
A = read.csv(paste("A_", tag, ".csv", sep = ""), header = FALSE)
Z = read.csv(paste("Z_", tag, ".csv", sep = ""), header = FALSE)
Y = read.csv(paste("Y_", tag, ".csv", sep = ""), header = FALSE)
```

```{r}
z.mat = as.matrix(Z)

A1_indices = which(A==1)
A0_indices = which(A==0)
```

```{r}
total.diff1 = 0

for (i in A1_indices){
  diffs = wordspace::rowNorms(sweep(z.mat[A0_indices,], 2, z.mat[i,]))
  match = which.min(diffs)
  total.diff1 = total.diff1 + Y[i,] - Y[A0_indices[match],]
}

est1 = total.diff1 / length(A1_indices)
```

```{r}
total.diff2 = 0

for (i in A0_indices){
  diffs = wordspace::rowNorms(sweep(z.mat[A1_indices,], 2, z.mat[i,]))
  match = which.min(diffs)
  total.diff2 = total.diff2 - Y[i,] + Y[A1_indices[match],]
}

est2 = total.diff2 / length(A0_indices)
```

```{r}
ATE = (total.diff1 + total.diff2) / length(A$V1)
ATE
```
